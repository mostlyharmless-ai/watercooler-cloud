# Watercooler Cloud - Cloudflare Worker Configuration
# Dual-stack deployment: staging and production environments

name = "watercooler-cloud"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]
workers_dev = true
preview_urls = true
account_id = "368d2724892d827312b997a7f06db1a5"

################################################################################
# PRODUCTION ENVIRONMENT (default)
################################################################################

[vars]
BACKEND_URL = "https://watercooler-cloud.onrender.com"
# ALLOW_DEV_SESSION not set - defaults to false (OAuth required)
# AUTO_ENROLL_PROJECTS not set - defaults to false (explicit ACL management)

[[kv_namespaces]]
binding = "KV_PROJECTS"
id = "2f2d304b3d8c4522830a9460098b5559"

[durable_objects]
bindings = [
  { name = "SESSION_MANAGER", class_name = "SessionManager" }
]

[[migrations]]
tag = "v1-session"
new_sqlite_classes = ["SessionManager"]

################################################################################
# STAGING ENVIRONMENT
################################################################################

[env.staging]
name = "watercooler-cloud-staging"

[env.staging.vars]
BACKEND_URL = "https://watercooler-cloud-staging.onrender.com"
ALLOW_DEV_SESSION = "false"
AUTO_ENROLL_PROJECTS = "false"

[[env.staging.kv_namespaces]]
binding = "KV_PROJECTS"
id = "b9b8b18bba6943878c892c4108371dc2"

[env.staging.durable_objects]
bindings = [
  { name = "SESSION_MANAGER", class_name = "SessionManager" }
]

[[env.staging.migrations]]
tag = "v1-session"
new_sqlite_classes = ["SessionManager"]

################################################################################
# OPTIONAL CONFIGURATION
################################################################################

# Cron triggers for periodic cleanup tasks
[triggers]
crons = ["*/15 * * * *"]

# Optional smart routing (uncomment if needed)
# [placement]
# mode = "smart"
